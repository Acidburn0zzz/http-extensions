<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Opportunistic Security for HTTP</title><script type="application/javascript">
function anchorRewrite() {
  map = { };
  if (window.location.hash.length >= 1) {
    var fragid = window.location.hash.substr(1);
    if (fragid) {
      if (! document.getElementById(fragid)) {
        var prefix = "rfc";
        var mapped = map[fragid];
        if (mapped) {
          window.location.hash = mapped;
        } else if (fragid.indexOf("section-") == 0) {
          window.location.hash = prefix + ".section." + fragid.substring(8);
        } else if (fragid.indexOf("appendix-") == 0) {
          window.location.hash = prefix + ".section." + fragid.substring(9);
        }
      }
    }  
  }
}
window.addEventListener('hashchange', anchorRewrite);
window.addEventListener('DOMContentLoaded', anchorRewrite);
</script><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"><style type="text/css">
      body {
        padding-top: 80px;
        padding-bottom: 80px;
        position: relative;
      }
      .table.header th, .table.header td {
        border-top: none;
        padding: 0;
      }
      #rfc\.meta {
        width: 40%;
        float: right
      }
      #rfc\.toc > ul li {
        list-style: none;
      }
      .container .nav-sublist {
        padding-left: 20px;
        padding-right: 10px;
        font-size: 90%;
      }
      .container .navbar-brand {
        padding-top: 0;
      }
      .container .nav > li > a {
        padding: 10px 7px 5px 15px;
        display: inline-block;
      }
      .container .nav > li > a + a {
        padding: 10px 15px 5px 7px;
        display: inline-block;
      }
      .container .nav > li > a {
        padding: 5px 10px;
      }
      .filename {
        color: rgb(119, 119, 119);
        font-size: 23px;
        font-weight: normal;
        height: auto;
        line-height: 23px;
      }
      dl {
        margin-left: 1em;
      }
      dl.dl-horizontal: {
        margin-left: 0;
      }
      dl > dt {
        float: left;
        margin-right: 1em;
      }
      dl.nohang > dt {
        float: none;
      }
      dl > dd {
        margin-bottom: .5em;
      }
      dl.compact > dd {
        margin-bottom: 0em;
      }
      dl > dd > dl {
        margin-top: 0.5em;
        margin-bottom: 0em;
      }
      ul.empty {
        list-style-type: none;
      }
      ul.empty li {
        margin-top: .5em;
      }
      td.reference {
        padding-right: 1em;
        vertical-align: top;
      }
      .feedback {
        position: fixed;
        bottom: 5px;
        right: 5px;
      }
      .fbbutton {
        margin-left: 5px;
      }
      h1 a, h2 a, h3 a, h4 a, h5 a, h6 a {
        color: rgb(51, 51, 51);
      }
    </style><link rel="Author" href="#rfc.authors"><link rel="Copyright" href="#rfc.copyrightnotice"><link rel="Chapter" title="1 Introduction" href="#rfc.section.1"><link rel="Chapter" title="2 Using HTTP URIs over TLS" href="#rfc.section.2"><link rel="Chapter" title="3 Server Authentication" href="#rfc.section.3"><link rel="Chapter" title="4 Interaction with “https” URIs" href="#rfc.section.4"><link rel="Chapter" title="5 Requiring Use of TLS" href="#rfc.section.5"><link rel="Chapter" title="6 The “http-opportunistic” well-known URI" href="#rfc.section.6"><link rel="Chapter" title="7 IANA Considerations" href="#rfc.section.7"><link rel="Chapter" title="8 Security Considerations" href="#rfc.section.8"><link rel="Chapter" href="#rfc.section.9" title="9 References"><link rel="Appendix" title="A Acknowledgements" href="#rfc.section.A"><meta name="generator" content="https://github.com/mnot/RFCBootstrap XSLT vendor: SAXON 9.1.0.8 from Saxonica http://www.saxonica.com/"><meta name="keywords" content="Internet-Draft"><link rel="schema.dcterms" href="http://purl.org/dc/terms/"><meta name="dcterms.creator" content="Nottingham, M."><meta name="dcterms.creator" content="Thomson, M."><meta name="dcterms.identifier" content="urn:ietf:id:draft-ietf-httpbis-http2-encryption-latest"><meta name="dcterms.issued" scheme="ISO8601" content="2016-04-02"><meta name="dcterms.abstract" content="This document describes how http URIs can be accessed using Transport Layer Security (TLS) to mitigate pervasive monitoring attacks."><meta name="description" content="This document describes how http URIs can be accessed using Transport Layer Security (TLS) to mitigate pervasive monitoring attacks."></head><body><div class="container" id="top"><div class="row"><div class="col-md-4 col-md-push-8 hidden-sm hidden-xs" role="navigation"><div class="navbar"><div class="navbar-brand"><a href="#top">Internet-Draft</a></div><br clear="all"><div class=""><div id="rfc.toc"><ul class="nav"><li><a href="#rfc.section.1">1.</a>&nbsp;&nbsp;&nbsp;<a href="#introduction">Introduction</a><ul><li><a href="#rfc.section.1.1">1.1</a>&nbsp;&nbsp;&nbsp;<a href="#goals-and-non-goals">Goals and Non-Goals</a></li><li><a href="#rfc.section.1.2">1.2</a>&nbsp;&nbsp;&nbsp;<a href="#notational-conventions">Notational Conventions</a></li></ul></li><li><a href="#rfc.section.2">2.</a>&nbsp;&nbsp;&nbsp;<a href="#using-http-uris-over-tls">Using HTTP URIs over TLS</a></li><li><a href="#rfc.section.3">3.</a>&nbsp;&nbsp;&nbsp;<a href="#auth">Server Authentication</a></li><li><a href="#rfc.section.4">4.</a>&nbsp;&nbsp;&nbsp;<a href="#interaction-with-https-uris">Interaction with “https” URIs</a></li><li><a href="#rfc.section.5">5.</a>&nbsp;&nbsp;&nbsp;<a href="#commit">Requiring Use of TLS</a><ul><li><a href="#rfc.section.5.1">5.1</a>&nbsp;&nbsp;&nbsp;<a href="#opportunistic-commitment">Opportunistic Commitment</a></li><li><a href="#rfc.section.5.2">5.2</a>&nbsp;&nbsp;&nbsp;<a href="#client-handling-of-a-commitment">Client Handling of A Commitment</a></li><li><a href="#rfc.section.5.3">5.3</a>&nbsp;&nbsp;&nbsp;<a href="#pinrisks">Operational Considerations</a></li></ul></li><li><a href="#rfc.section.6">6.</a>&nbsp;&nbsp;&nbsp;<a href="#well-known">The “http-opportunistic” well-known URI</a></li><li><a href="#rfc.section.7">7.</a>&nbsp;&nbsp;&nbsp;<a href="#iana-considerations">IANA Considerations</a></li><li><a href="#rfc.section.8">8.</a>&nbsp;&nbsp;&nbsp;<a href="#security">Security Considerations</a><ul><li><a href="#rfc.section.8.1">8.1</a>&nbsp;&nbsp;&nbsp;<a href="#security-indicators">Security Indicators</a></li><li><a href="#rfc.section.8.2">8.2</a>&nbsp;&nbsp;&nbsp;<a href="#downgrade">Downgrade Attacks</a></li><li><a href="#rfc.section.8.3">8.3</a>&nbsp;&nbsp;&nbsp;<a href="#privacy">Privacy Considerations</a></li><li><a href="#rfc.section.8.4">8.4</a>&nbsp;&nbsp;&nbsp;<a href="#confusion-regarding-request-scheme">Confusion Regarding Request Scheme</a></li></ul></li><li><a href="#rfc.section.9">9.</a>&nbsp;&nbsp;&nbsp;<a href="#rfc.references">References</a><ul><li><a href="#rfc.section.9.1">9.1</a>&nbsp;&nbsp;&nbsp;<a href="#rfc.references.1">Normative References</a></li><li><a href="#rfc.section.9.2">9.2</a>&nbsp;&nbsp;&nbsp;<a href="#rfc.references.2">Informative References</a></li></ul></li><li><a href="#rfc.section.A">A.</a>&nbsp;&nbsp;&nbsp;<a href="#acknowledgements">Acknowledgements</a></li><li><a href="#rfc.authors">Authors' Addresses</a></li></ul></div></div></div></div><div class="col-md-8 col-md-pull-4 main" role="main"><table class="table table-condensed header" id="rfc.headerblock"><tbody><tr><td class="text-left">HTTP Working Group</td><td class="text-right">M. Nottingham</td></tr><tr><td class="text-left">Internet-Draft</td><td class="text-right">M. Thomson</td></tr><tr><td class="text-left">Intended status: Experimental</td><td class="text-right">Mozilla</td></tr><tr><td class="text-left">Expires: October 4, 2016</td><td class="text-right">April 2, 2016</td></tr></tbody></table><div id="rfc.title"><h1>Opportunistic Security for HTTP</h1><div class="filename">draft-ietf-httpbis-http2-encryption-latest</div></div><hr><h2 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h2><div class="lead"><p>This document describes how <span class="tt">http</span> URIs can be accessed using Transport Layer Security (TLS) to mitigate pervasive monitoring attacks.</p></div><h2 id="rfc.note.1"><a href="#rfc.note.1">Note to Readers</a></h2><p>Discussion of this draft takes place on the HTTP working group mailing list (ietf-http-wg@w3.org), which is archived at <a href="https://lists.w3.org/Archives/Public/ietf-http-wg/">https://lists.w3.org/Archives/Public/ietf-http-wg/</a>.</p><p>Working Group information can be found at <a href="http://httpwg.github.io/">http://httpwg.github.io/</a>; source code and issues list for this draft can be found at <a href="https://github.com/httpwg/http-extensions/labels/opp-sec">https://github.com/httpwg/http-extensions/labels/opp-sec</a>.</p><div id="rfc.status"><h2><a href="#rfc.status">Status of this Memo</a></h2><p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p><p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF). Note that other groups may also distribute working documents as Internet-Drafts. The list of current Internet-Drafts is at <a href="http://datatracker.ietf.org/drafts/current/">http://datatracker.ietf.org/drafts/current/</a>.</p><p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time. It is inappropriate to use Internet-Drafts as reference material or to cite them other than as “work in progress”.</p><p>This Internet-Draft will expire on October 4, 2016.</p></div><div id="rfc.copyrightnotice"><h2><a href="#rfc.copyrightnotice">Copyright Notice</a></h2><p>Copyright © 2016 IETF Trust and the persons identified as the document authors. All rights reserved.</p><p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of publication of this document. Please review these documents carefully, as they describe your rights and restrictions with respect to this document. Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p></div><div id="introduction"><h2 id="rfc.section.1" class="np"><a href="#rfc.section.1">1.</a>&nbsp;<a href="#introduction">Introduction</a></h2><div id="rfc.section.1.p.1"><p>This document describes a use of HTTP Alternative Services <a href="#I-D.ietf-httpbis-alt-svc"><cite title="HTTP Alternative Services">[I-D.ietf-httpbis-alt-svc]</cite></a> to decouple the URI scheme from the use and configuration of underlying encryption, allowing a <span class="tt">http</span> URI <a href="#RFC7230"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[RFC7230]</cite></a> to be accessed using Transport Layer Security (TLS) <a href="#RFC5246"><cite title="The Transport Layer Security (TLS) Protocol Version 1.2">[RFC5246]</cite></a> opportunistically.</p></div><div id="rfc.section.1.p.2"><p>Serving <span class="tt">https</span> URIs require acquiring and configuring a valid certificate, which means that some deployments find supporting TLS difficult. This document describes a usage model whereby sites can serve <span class="tt">http</span> URIs over TLS without being required to support strong server authentication.</p></div><div id="rfc.section.1.p.3"><p>Opportunistic Security <a href="#RFC7435"><cite title="Opportunistic Security: Some Protection Most of the Time">[RFC7435]</cite></a> does not provide the same guarantees as using TLS with <span class="tt">https</span> URIs; it is vulnerable to active attacks, and does not change the security context of the connection. Normally, users will not be able to tell that it is in use (i.e., there will be no “lock icon”).</p></div><div id="rfc.section.1.p.4"><p>A mechanism for partially mitigating active attacks is described in <a href="#commit" title="Requiring Use of TLS">Section&nbsp;5</a>.</p></div><div id="goals-and-non-goals"><h3 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1</a>&nbsp;<a href="#goals-and-non-goals">Goals and Non-Goals</a></h3><div id="rfc.section.1.1.p.1"><p>The immediate goal is to make the use of HTTP more robust in the face of pervasive passive monitoring <a href="#RFC7258"><cite title="Pervasive Monitoring Is an Attack">[RFC7258]</cite></a>.</p></div><div id="rfc.section.1.1.p.2"><p>A secondary goal is to limit the potential for active attacks. It is not intended to offer the same level of protection as afforded to <span class="tt">https</span> URIs, but instead to increase the likelihood that an active attack can be detected.</p></div><div id="rfc.section.1.1.p.3"><p>A final (but significant) goal is to provide for ease of implementation, deployment and operation. This mechanism is expected to have a minimal impact upon performance, and require a trivial administrative effort to configure.</p></div></div><div id="notational-conventions"><h3 id="rfc.section.1.2"><a href="#rfc.section.1.2">1.2</a>&nbsp;<a href="#notational-conventions">Notational Conventions</a></h3><div id="rfc.section.1.2.p.1"><p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in <a href="#RFC2119"><cite title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</cite></a>.</p></div></div></div><div id="using-http-uris-over-tls"><h2 id="rfc.section.2"><a href="#rfc.section.2">2.</a>&nbsp;<a href="#using-http-uris-over-tls">Using HTTP URIs over TLS</a></h2><div id="rfc.section.2.p.1"><p>An origin server that supports the resolution of <span class="tt">http</span> URIs can indicate support for this specification by providing an alternative service advertisement <a href="#I-D.ietf-httpbis-alt-svc"><cite title="HTTP Alternative Services">[I-D.ietf-httpbis-alt-svc]</cite></a> for a protocol identifier that uses TLS, such as <span class="tt">h2</span> <a href="#RFC7540"><cite title="Hypertext Transfer Protocol Version 2 (HTTP/2)">[RFC7540]</cite></a>.</p></div><div id="rfc.section.2.p.2"><p>A client that receives such an advertisement MAY make future requests intended for the associated origin (<a href="#RFC6454"><cite title="The Web Origin Concept">[RFC6454]</cite></a>) to the identified service (as specified by <a href="#I-D.ietf-httpbis-alt-svc"><cite title="HTTP Alternative Services">[I-D.ietf-httpbis-alt-svc]</cite></a>).</p></div><div id="rfc.section.2.p.3"><p>A client that places the importance of protection against passive attacks over performance might choose to withhold requests until an encrypted connection is available. However, if such a connection cannot be successfully established, the client can resume its use of the cleartext connection.</p></div><div id="rfc.section.2.p.4"><p>A client can also explicitly probe for an alternative service advertisement by sending a request that bears little or no sensitive information, such as one with the OPTIONS method. Likewise, clients with existing alternative services information could make such a request before they expire, in order minimize the delays that might be incurred.</p></div></div><div id="auth"><h2 id="rfc.section.3"><a href="#rfc.section.3">3.</a>&nbsp;<a href="#auth">Server Authentication</a></h2><div id="rfc.section.3.p.1"><p><a href="#I-D.ietf-httpbis-alt-svc"><cite title="HTTP Alternative Services">[I-D.ietf-httpbis-alt-svc]</cite></a> requires that an alternative service only be used when there are “reasonable assurances” that it is under control of and valid for the whole origin.</p></div><div id="rfc.section.3.p.2"><p>As defined in that specification, one way of establishing this is using a TLS-based protocol with the certificate checks defined in <a href="#RFC2818"><cite title="HTTP Over TLS">[RFC2818]</cite></a>. Clients are permitted to impose additional criteria for establishing reasonable assurances.</p></div><div id="rfc.section.3.p.3"><p>For the purposes of this specification, an additional way of establishing reasonable assurances is available when the alternative is on the same host as the origin, using the “http-opportunistic” well-known URI defined in <a href="#well-known" title="The “http-opportunistic” well-known URI">Section&nbsp;6</a>.</p></div><div id="rfc.section.3.p.4"><p>This allows deployment without the use of valid certificates, to encourage deployment of opportunistic security. When it is in use, the alternative service can provide any certificate, or even select TLS cipher suites that do not include authentication.</p></div><div id="rfc.section.3.p.5" class="avoidbreakafter"><p>A client acquires an http-opportunistic response by making a GET request to the “http-opportunistic” well-known URI. When the client has a valid http-opportunistic response for an origin, it MAY consider there to be reasonable assurances when:</p></div><div id="rfc.section.3.p.6"><ul><li>The origin and alternative service’s hostnames are the same when compared in a case-insensitive fashion, and</li><li>The chosen alternative service returns the same response as above.</li></ul></div><div id="rfc.section.3.p.7" class="avoidbreakafter"><p>For example, this request/response pair would constitute reasonable assurances for the origin “http://www.example.com” for any alternative service also on “www.example.com”:</p></div><div id="rfc.figure.u.1"><pre class="text">
GET /.well-known/http-opportunistic HTTP/1.1
Host: www.example.com

HTTP/1.1 200 OK
Content-Type: application/json
Connection: close

{
  "origins": ["http://www.example.com", "http://example.com:81"]
}
</pre></div><div id="rfc.section.3.p.8"><p>Note that this mechanism is only defined to establish reasonable assurances for the purposes of this specification; it does not apply to other uses of alternative services unless they explicitly invoke it.</p></div></div><div id="interaction-with-https-uris"><h2 id="rfc.section.4"><a href="#rfc.section.4">4.</a>&nbsp;<a href="#interaction-with-https-uris">Interaction with “https” URIs</a></h2><div id="rfc.section.4.p.1"><p>When using alternative services, requests for resources identified by both <span class="tt">http</span> and <span class="tt">https</span> URIs might use the same connection, because HTTP/2 permits requests for multiple origins on the same connection.</p></div><div id="rfc.section.4.p.2"><p>Since <span class="tt">https</span> URIs rely on server authentication, a connection that is initially created for <span class="tt">http</span> URIs without authenticating the server cannot be used for <span class="tt">https</span> URIs until the server certificate is successfully authenticated. Section 3.1 of <a href="#RFC2818"><cite title="HTTP Over TLS">[RFC2818]</cite></a> describes the basic mechanism, though the authentication considerations in Section 2.1 of <a href="#I-D.ietf-httpbis-alt-svc"><cite title="HTTP Alternative Services">[I-D.ietf-httpbis-alt-svc]</cite></a> also apply.</p></div><div id="rfc.section.4.p.3"><p>Connections that are established without any means of server authentication (for instance, the purely anonymous TLS cipher suites) cannot be used for <span class="tt">https</span> URIs.</p></div></div><div id="commit"><h2 id="rfc.section.5"><a href="#rfc.section.5">5.</a>&nbsp;<a href="#commit">Requiring Use of TLS</a></h2><div id="rfc.section.5.p.1" class="avoidbreakafter"><p>Even when the alternative service is strongly authenticated, opportunistically upgrading cleartext HTTP connections to use TLS is subject to active attacks. In particular:</p></div><div id="rfc.section.5.p.2"><ul><li>Because the original HTTP connection is in cleartext, it is vulnerable to man-in-the-middle attacks, and</li><li>By default, if clients cannot reach the alternative service, they will fall back to using the original cleartext origin.</li></ul></div><div id="rfc.section.5.p.3"><p>Given that the primary goal of this specification is to prevent passive attacks, these are not critical failings (especially considering the alternative - HTTP over cleartext). However, a modest form of protection against active attacks can be provided for clients on subsequent connections.</p></div><div id="rfc.section.5.p.4"><p>When an origin is able to commit to providing service for a particular origin over TLS for a bounded period of time, clients can choose to rely upon its availability, failing when it cannot be contacted. Effectively, this makes the choice to use a secured protocol “sticky”.</p></div><div id="opportunistic-commitment"><h3 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1</a>&nbsp;<a href="#opportunistic-commitment">Opportunistic Commitment</a></h3><div id="rfc.section.5.1.p.1"><p>An origin can reduce the risk of attacks on opportunistically secured connections by committing to provide a secured, authenticated alternative service. This is done by including the optional <span class="tt">commit</span> member in the http-opportunistic well-known resource (see <a href="#well-known" title="The “http-opportunistic” well-known URI">Section&nbsp;6</a>). This feature is optional due to the requirement for server authentication and the potential risk entailed (see <a href="#pinrisks" title="Operational Considerations">Section&nbsp;5.3</a>).</p></div><div id="rfc.section.5.1.p.2"><p>The value of the <span class="tt">commit</span> member is a number (<a href="#RFC7159"><cite title="The JavaScript Object Notation (JSON) Data Interchange Format">[RFC7159]</cite></a>, Section 6) indicating the duration of the commitment interval in seconds.</p></div><div id="rfc.figure.u.2"><pre class="text">
{
  "origins": ["http://example.com", "http://www.example.com:81"],
  "commit": 86400
}
</pre></div><div id="rfc.section.5.1.p.3"><p>Including <span class="tt">commit</span> creates a commitment to provide a secured alternative service for the advertised period. Clients that receive this commitment can assume that a secured alternative service will be available for the indicated period. Clients might however choose to limit this time (see <a href="#pinrisks" title="Operational Considerations">Section&nbsp;5.3</a>).</p></div></div><div id="client-handling-of-a-commitment"><h3 id="rfc.section.5.2"><a href="#rfc.section.5.2">5.2</a>&nbsp;<a href="#client-handling-of-a-commitment">Client Handling of A Commitment</a></h3><div id="rfc.section.5.2.p.1"><p>The value of the <span class="tt">commit</span> member MUST be ignored unless the alternative service can be strongly authenticated. The same authentication requirements that apply to <span class="tt">https://</span> resources SHOULD be applied to authenticating the alternative. Minimum authentication requirements for HTTP over TLS are described in Section 2.1 of <a href="#I-D.ietf-httpbis-alt-svc"><cite title="HTTP Alternative Services">[I-D.ietf-httpbis-alt-svc]</cite></a> and Section 3.1 of <a href="#RFC2818"><cite title="HTTP Over TLS">[RFC2818]</cite></a>. As noted in <a href="#I-D.ietf-httpbis-alt-svc"><cite title="HTTP Alternative Services">[I-D.ietf-httpbis-alt-svc]</cite></a>, clients can impose other checks in addition to this minimum set. For instance, a client might choose to apply key pinning <a href="#RFC7469"><cite title="Public Key Pinning Extension for HTTP">[RFC7469]</cite></a>.</p></div><div id="rfc.section.5.2.p.2"><p>A client that receives a commitment and that successfully authenticates the alternative service can assume that a secured alternative will remain available for the commitment interval. The commitment interval starts when the commitment is received and authenticated and runs for a number of seconds equal to value of the <span class="tt">commit</span> member, less the current age of the http-opportunistic response (as defined in Section 4.2.3 of <a href="#RFC7234"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Caching">[RFC7234]</cite></a>). A client SHOULD avoid sending requests via cleartext protocols or to unauthenticated alternative services for the duration of the commitment interval, except to discover new potential alternatives.</p></div><div id="rfc.section.5.2.p.3"><p>A commitment only applies to the origin of the http-opportunistic well-known resource that was retrieved; other origins listed in the <span class="tt">origins</span> member MUST be independently discovered and authenticated.</p></div><div id="rfc.section.5.2.p.4"><p>A commitment is not bound to a particular alternative service. Clients are able to use alternative services that they become aware of. However, once a valid and authenticated commitment has been received, clients SHOULD NOT use an unauthenticated alternative service. Where there is an active commitment, clients SHOULD ignore advertisements for unsecured alternative services. A client MAY send requests to an unauthenticated origin in an attempt to discover potential alternative services, but these requests SHOULD be entirely generic and avoid including credentials.</p></div></div><div id="pinrisks"><h3 id="rfc.section.5.3"><a href="#rfc.section.5.3">5.3</a>&nbsp;<a href="#pinrisks">Operational Considerations</a></h3><div id="rfc.section.5.3.p.1"><p>Errors in configuration of commitments has the potential to render even the unsecured origin inaccessible for the duration of a commitment. Initial deployments are encouraged to use short duration commitments so that errors can be detected without causing the origin to become inaccessible to clients for extended periods.</p></div><div id="rfc.section.5.3.p.2"><p>To avoid situations where a commitment causes errors, clients MAY limit the time over which a commitment is respected for a given origin. A lower limit might be appropriate for initial commitments; the certainty that a site has set a correct value - and the corresponding limit on persistence - might increase as a commitment is renewed multiple times.</p></div></div></div><div id="well-known"><h2 id="rfc.section.6"><a href="#rfc.section.6">6.</a>&nbsp;<a href="#well-known">The “http-opportunistic” well-known URI</a></h2><div id="rfc.section.6.p.1" class="avoidbreakafter"><p>This specification defines the “http-opportunistic” well-known URI <a href="#RFC5785"><cite title="Defining Well-Known Uniform Resource Identifiers (URIs)">[RFC5785]</cite></a>. An origin is said to have a valid http-opportunistic resource when:</p></div><div id="rfc.section.6.p.2"><ul><li>The client has obtained a 200 (OK) response for the well-known URI from the origin, or refreshed one in cache <a href="#RFC7234"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Caching">[RFC7234]</cite></a>, and</li><li>That response has the media type “application/json”, and</li><li>That response’s payload, when parsed as JSON <a href="#RFC7159"><cite title="The JavaScript Object Notation (JSON) Data Interchange Format">[RFC7159]</cite></a>, contains an object as the root.</li><li>The “origins” member of the root object has a value of an array of strings, one of which is a case-insensitive character-for-character match for the origin in question, serialised into Unicode as per Section 6.1 of <a href="#RFC6454"><cite title="The Web Origin Concept">[RFC6454]</cite></a>.</li></ul></div><div id="rfc.section.6.p.3"><p>This specification defines one additional, optional member of the root object, “commit” in <a href="#commit" title="Requiring Use of TLS">Section&nbsp;5</a>. Unrecognised members MUST be ignored.</p></div></div><div id="iana-considerations"><h2 id="rfc.section.7"><a href="#rfc.section.7">7.</a>&nbsp;<a href="#iana-considerations">IANA Considerations</a></h2><div id="rfc.section.7.p.1" class="avoidbreakafter"><p>This specification registers a Well-Known URI <a href="#RFC5785"><cite title="Defining Well-Known Uniform Resource Identifiers (URIs)">[RFC5785]</cite></a>:</p></div><div id="rfc.section.7.p.2" class="avoidbreakafter"><ul><li>URI Suffix: http-opportunistic</li><li>Change Controller: IETF</li><li>Specification Document(s): <a href="#well-known" title="The “http-opportunistic” well-known URI">Section&nbsp;6</a> of [this specification]</li><li>Related Information:</li></ul></div></div><div id="security"><h2 id="rfc.section.8"><a href="#rfc.section.8">8.</a>&nbsp;<a href="#security">Security Considerations</a></h2><div id="security-indicators"><h3 id="rfc.section.8.1"><a href="#rfc.section.8.1">8.1</a>&nbsp;<a href="#security-indicators">Security Indicators</a></h3><div id="rfc.section.8.1.p.1"><p>User Agents MUST NOT provide any special security indicia when an <span class="tt">http</span> resource is acquired using TLS. In particular, indicators that might suggest the same level of security as <span class="tt">https</span> MUST NOT be used (e.g., a “lock device”).</p></div></div><div id="downgrade"><h3 id="rfc.section.8.2"><a href="#rfc.section.8.2">8.2</a>&nbsp;<a href="#downgrade">Downgrade Attacks</a></h3><div id="rfc.section.8.2.p.1"><p>A downgrade attack against the negotiation for TLS is possible. With commitment (see <a href="#commit" title="Requiring Use of TLS">Section&nbsp;5</a>), this is limited to occasions where clients have no prior information (see <a href="#privacy" title="Privacy Considerations">Section&nbsp;8.3</a>), or when persisted commitments have expired.</p></div><div id="rfc.section.8.2.p.2"><p>For example, because the <span class="tt">Alt-Svc</span> header field <a href="#I-D.ietf-httpbis-alt-svc"><cite title="HTTP Alternative Services">[I-D.ietf-httpbis-alt-svc]</cite></a> likely appears in an unauthenticated and unencrypted channel, it is subject to downgrade by network attackers. In its simplest form, an attacker that wants the connection to remain in the clear need only strip the <span class="tt">Alt-Svc</span> header field from responses.</p></div><div id="rfc.section.8.2.p.3"><p>Downgrade attacks can be partially mitigated using the <span class="tt">commit</span> member of the http-opportunistic well-known resource, because when it is used, a client can avoid using cleartext to contact a supporting server. However, this only works when a previous connection has been established without an active attacker present; a continuously present active attacker can either prevent the client from ever using TLS, or offer its own certificate.</p></div></div><div id="privacy"><h3 id="rfc.section.8.3"><a href="#rfc.section.8.3">8.3</a>&nbsp;<a href="#privacy">Privacy Considerations</a></h3><div id="rfc.section.8.3.p.1"><p>Cached alternative services can be used to track clients over time; e.g., using a user-specific hostname. Clearing the cache reduces the ability of servers to track clients; therefore clients MUST clear cached alternative service information when clearing other origin-based state (i.e., cookies).</p></div></div><div id="confusion-regarding-request-scheme"><h3 id="rfc.section.8.4"><a href="#rfc.section.8.4">8.4</a>&nbsp;<a href="#confusion-regarding-request-scheme">Confusion Regarding Request Scheme</a></h3><div id="rfc.section.8.4.p.1"><p>Some HTTP/1.1 implementations use ambient signals to determine if a request is for an <span class="tt">https</span> resource. For example, implementations might look for TLS on the stack or a port number of 443. This is necessary in many cases because the most common form of an HTTP/1.1 request does not carry an explicit indication of the URI scheme. An implementation that is serving an opportunistically secured request SHOULD suppress these signals for <span class="tt">http</span> resources.</p></div><div id="rfc.section.8.4.p.2"><p>HTTP/1.1 MUST NOT be used to serve opportunistically secured requests. HTTP/1.1 can be used to discover an opportunistically secured alternative service.</p></div></div></div><h2 id="rfc.references"><a id="rfc.section.9" href="#rfc.section.9">9.</a> References</h2><h3 id="rfc.references.1"><a href="#rfc.section.9.1" id="rfc.section.9.1">9.1</a> Normative References</h3><dl class="dl-horizontal"><dt id="I-D.ietf-httpbis-alt-svc">[I-D.ietf-httpbis-alt-svc]</dt><dd>mnot, m., McManus, P., and J. Reschke, “<a href="https://tools.ietf.org/html/draft-ietf-httpbis-alt-svc-14">HTTP Alternative Services</a>”, Internet-Draft&nbsp;draft-ietf-httpbis-alt-svc-14 (work in progress), March&nbsp;2016.</dd><dt id="RFC2119">[RFC2119]</dt><dd>Bradner, S., “<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>”, BCP&nbsp;14, RFC&nbsp;2119, <a href="http://dx.doi.org/10.17487/RFC2119">DOI&nbsp;10.17487/RFC2119</a>, March&nbsp;1997, &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.</dd><dt id="RFC2818">[RFC2818]</dt><dd>Rescorla, E., “<a href="https://tools.ietf.org/html/rfc2818">HTTP Over TLS</a>”, RFC&nbsp;2818, <a href="http://dx.doi.org/10.17487/RFC2818">DOI&nbsp;10.17487/RFC2818</a>, May&nbsp;2000, &lt;<a href="http://www.rfc-editor.org/info/rfc2818">http://www.rfc-editor.org/info/rfc2818</a>&gt;.</dd><dt id="RFC5246">[RFC5246]</dt><dd>Dierks, T. and E. Rescorla, “<a href="https://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>”, RFC&nbsp;5246, <a href="http://dx.doi.org/10.17487/RFC5246">DOI&nbsp;10.17487/RFC5246</a>, August&nbsp;2008, &lt;<a href="http://www.rfc-editor.org/info/rfc5246">http://www.rfc-editor.org/info/rfc5246</a>&gt;.</dd><dt id="RFC5785">[RFC5785]</dt><dd>Nottingham, M. and E. Hammer-Lahav, “<a href="https://tools.ietf.org/html/rfc5785">Defining Well-Known Uniform Resource Identifiers (URIs)</a>”, RFC&nbsp;5785, <a href="http://dx.doi.org/10.17487/RFC5785">DOI&nbsp;10.17487/RFC5785</a>, April&nbsp;2010, &lt;<a href="http://www.rfc-editor.org/info/rfc5785">http://www.rfc-editor.org/info/rfc5785</a>&gt;.</dd><dt id="RFC6454">[RFC6454]</dt><dd>Barth, A., “<a href="https://tools.ietf.org/html/rfc6454">The Web Origin Concept</a>”, RFC&nbsp;6454, <a href="http://dx.doi.org/10.17487/RFC6454">DOI&nbsp;10.17487/RFC6454</a>, December&nbsp;2011, &lt;<a href="http://www.rfc-editor.org/info/rfc6454">http://www.rfc-editor.org/info/rfc6454</a>&gt;.</dd><dt id="RFC7159">[RFC7159]</dt><dd>Bray, T., Ed., “<a href="https://tools.ietf.org/html/rfc7159">The JavaScript Object Notation (JSON) Data Interchange Format</a>”, RFC&nbsp;7159, <a href="http://dx.doi.org/10.17487/RFC7159">DOI&nbsp;10.17487/RFC7159</a>, March&nbsp;2014, &lt;<a href="http://www.rfc-editor.org/info/rfc7159">http://www.rfc-editor.org/info/rfc7159</a>&gt;.</dd><dt id="RFC7230">[RFC7230]</dt><dd>Fielding, R., Ed. and J. Reschke, Ed., “<a href="https://tools.ietf.org/html/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>”, RFC&nbsp;7230, <a href="http://dx.doi.org/10.17487/RFC7230">DOI&nbsp;10.17487/RFC7230</a>, June&nbsp;2014, &lt;<a href="http://www.rfc-editor.org/info/rfc7230">http://www.rfc-editor.org/info/rfc7230</a>&gt;.</dd><dt id="RFC7234">[RFC7234]</dt><dd>Fielding, R., Ed., Nottingham, M., Ed., and J. Reschke, Ed., “<a href="https://tools.ietf.org/html/rfc7234">Hypertext Transfer Protocol (HTTP/1.1): Caching</a>”, RFC&nbsp;7234, <a href="http://dx.doi.org/10.17487/RFC7234">DOI&nbsp;10.17487/RFC7234</a>, June&nbsp;2014, &lt;<a href="http://www.rfc-editor.org/info/rfc7234">http://www.rfc-editor.org/info/rfc7234</a>&gt;.</dd><dt id="RFC7540">[RFC7540]</dt><dd>Belshe, M., Peon, R., and M. Thomson, Ed., “<a href="https://tools.ietf.org/html/rfc7540">Hypertext Transfer Protocol Version 2 (HTTP/2)</a>”, RFC&nbsp;7540, <a href="http://dx.doi.org/10.17487/RFC7540">DOI&nbsp;10.17487/RFC7540</a>, May&nbsp;2015, &lt;<a href="http://www.rfc-editor.org/info/rfc7540">http://www.rfc-editor.org/info/rfc7540</a>&gt;.</dd></dl><h3 id="rfc.references.2"><a href="#rfc.section.9.2" id="rfc.section.9.2">9.2</a> Informative References</h3><dl class="dl-horizontal"><dt id="RFC7258">[RFC7258]</dt><dd>Farrell, S. and H. Tschofenig, “<a href="https://tools.ietf.org/html/rfc7258">Pervasive Monitoring Is an Attack</a>”, BCP&nbsp;188, RFC&nbsp;7258, <a href="http://dx.doi.org/10.17487/RFC7258">DOI&nbsp;10.17487/RFC7258</a>, May&nbsp;2014, &lt;<a href="http://www.rfc-editor.org/info/rfc7258">http://www.rfc-editor.org/info/rfc7258</a>&gt;.</dd><dt id="RFC7435">[RFC7435]</dt><dd>Dukhovni, V., “<a href="https://tools.ietf.org/html/rfc7435">Opportunistic Security: Some Protection Most of the Time</a>”, RFC&nbsp;7435, <a href="http://dx.doi.org/10.17487/RFC7435">DOI&nbsp;10.17487/RFC7435</a>, December&nbsp;2014, &lt;<a href="http://www.rfc-editor.org/info/rfc7435">http://www.rfc-editor.org/info/rfc7435</a>&gt;.</dd><dt id="RFC7469">[RFC7469]</dt><dd>Evans, C., Palmer, C., and R. Sleevi, “<a href="https://tools.ietf.org/html/rfc7469">Public Key Pinning Extension for HTTP</a>”, RFC&nbsp;7469, <a href="http://dx.doi.org/10.17487/RFC7469">DOI&nbsp;10.17487/RFC7469</a>, April&nbsp;2015, &lt;<a href="http://www.rfc-editor.org/info/rfc7469">http://www.rfc-editor.org/info/rfc7469</a>&gt;.</dd></dl><div id="acknowledgements"><h2 id="rfc.section.A" class="np"><a href="#rfc.section.A">A.</a>&nbsp;<a href="#acknowledgements">Acknowledgements</a></h2><div id="rfc.section.A.p.1"><p>Thanks to Patrick McManus, Eliot Lear, Stephen Farrell, Guy Podjarny, Stephen Ludin, Erik Nygren, Paul Hoffman, Adam Langley, Eric Rescorla, Julian Reschke, Kari Hurtta, and Richard Barnes for their feedback and suggestions.</p></div></div><div class="avoidbreakinside"><h2 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h2><p><b>Mark Nottingham</b><br>EMail: <a href="mailto:mnot@mnot.net">mnot@mnot.net</a><br>URI: <a href="http://www.mnot.net/">http://www.mnot.net/</a></p><p><b>Martin Thomson</b><br>Mozilla<br>EMail: <a href="mailto:martin.thomson@gmail.com">martin.thomson@gmail.com</a></p></div></div></div></div><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script></body></html>